<%# locals: (admin_user:) %>

<%= content_for(:roadblock) do %>
  <header>
    <icon aria-hidden="true" class="icon" data-icon="koi">&nbsp;</icon>
    <h1>Koi</h1>
    <h2><%= Koi.config.site_name || URI.parse(root_url).host %></h2>
  </header>

  <%= form_with(
        model: admin_user,
        scope: :admin,
        url:   admin_session_path,
        data:  {
          controller:                            "webauthn-authentication",
          webauthn_authentication_options_value:,
        },
      ) do |form| %>
    <%# note, autocomplete off is ignored by browsers but required by PCI-DSS %>
    <%= form.govuk_email_field :email, autofocus: true, autocomplete: "off" %>
    <%= form.hidden_field :response, data: { webauthn_authentication_target: "response" } %>
    <% (redirect = flash[:redirect] || params[:redirect]) && flash.delete(:redirect) %>
    <%= hidden_field_tag(:redirect, redirect) %>
    <div class="actions">
      <%= form.button("Next", type: :submit, class: "button") %>
      <%= form.button(type: :button, class: "button button--secondary", data: { action: "webauthn-authentication#authenticate" }) do %>
        <icon class="icon" data-icon="fingerprint" aria-label="Passkey">&nbsp;</icon>
      <% end %>
    </div>
  <% end %>
<% end %>
